# WALL-E Wildlife Robot Control Panel

<!-- Generated by Claude -->

A React-based web control panel for the WALL-E wildlife monitoring robot, featuring real-time camera streaming, GPS waypoint management, costmap visualization, and manual robot control.

## Features

- **Live Camera Feed**: Real-time MJPEG video stream from the robot's camera
- **Google Maps Integration**: Satellite view with GPS waypoint creation and editing
- **Costmap Visualization**: Leaflet.js-based map showing the robot's global costmap and position
- **Robot Stats Dashboard**: Real-time monitoring of temperature, battery, solar power, and system status
- **Manual Control**: On-screen joystick for direct robot movement control
- **ROS2 Integration**: Full ROSBridge WebSocket connectivity for real-time data

## Architecture

```
web_app/
├── backend/                 # FastAPI Python backend
│   ├── main.py             # Main FastAPI application
│   ├── routers/            # API route handlers
│   │   ├── camera.py       # Camera streaming endpoints
│   │   ├── robot.py        # Robot stats and navigation
│   │   └── waypoints.py    # Waypoint CRUD operations
│   ├── services/           # Service layer
│   │   └── rosbridge_client.py  # ROSBridge WebSocket client
│   └── requirements.txt    # Python dependencies
├── frontend/               # React TypeScript frontend
│   ├── src/
│   │   ├── components/     # React components
│   │   │   ├── CameraFeed.tsx
│   │   │   ├── GoogleMapsPanel.tsx
│   │   │   ├── CostmapViewer.tsx
│   │   │   ├── StatsPanel.tsx
│   │   │   └── JoystickControl.tsx
│   │   ├── services/       # Frontend services
│   │   │   ├── rosbridge.ts  # ROSLib + Zustand state
│   │   │   └── api.ts        # REST API client
│   │   ├── App.tsx         # Main application
│   │   └── App.css         # Styling (dark theme)
│   ├── package.json
│   └── vite.config.ts
├── Dockerfile              # Standalone Docker build
└── archive/                # Old Flask app (preserved)
```

## Prerequisites

- Node.js 20+
- Python 3.11+
- ROS2 (Jazzy) with rosbridge-suite
- Docker (for containerized deployment)
- Google Maps API key

## Development Setup

### Backend

```bash
cd /home/ndev/WALL-E/web_app/backend
pip install -r requirements.txt
python main.py
```

Backend runs at http://localhost:8000

### Frontend

```bash
cd /home/ndev/WALL-E/web_app/frontend
npm install
cp .env.example .env
# Edit .env and add your Google Maps API key:
# VITE_GOOGLE_MAPS_API_KEY=your_api_key_here
npm run dev
```

Frontend runs at http://localhost:3000

## Docker Deployment

### Using the main WALL-E Docker image

The web app is included in the main `walle/ros2:jazzy` Docker image.

**Build the Docker image:**
```bash
cd /home/ndev/WALL-E/docker
./start_docker.sh --build
```

**Run the web app with ROSBridge:**
```bash
cd /home/ndev/WALL-E/docker
./start_docker.sh --rosbridge --webapp
```

This starts both:
- ROSBridge WebSocket server on port 9090
- Web control panel on port 8000

**Access the control panel:**
- Local: http://localhost:8000
- ZeroTier: http://<zerotier-ip>:8000

### Standalone Docker build

```bash
cd /home/ndev/WALL-E/web_app
docker build -t walle/web-app .
docker run -d -p 8000:8000 --device=/dev/video0 walle/web-app
```

## API Endpoints

### Camera
- `GET /api/camera/stream` - MJPEG video stream
- `GET /api/camera/snapshot` - Single frame capture
- `GET /api/camera/status` - Camera availability

### Robot
- `GET /api/robot/stats` - Robot telemetry
- `POST /api/navigation/goal` - Send navigation goal
- `POST /api/navigation/cancel` - Cancel navigation
- `POST /api/robot/command` - Send robot commands

### Waypoints
- `GET /api/waypoints` - List all waypoints
- `POST /api/waypoints` - Add waypoint
- `PUT /api/waypoints` - Replace all waypoints
- `DELETE /api/waypoints` - Clear waypoints
- `GET /api/waypoints/{index}` - Get single waypoint
- `DELETE /api/waypoints/{index}` - Delete waypoint

### WebSocket
- `WS /api/ws/ros` - Real-time ROS data stream

## ROS2 Topics

The web app subscribes to and publishes on these ROS2 topics:

| Topic | Type | Direction | Description |
|-------|------|-----------|-------------|
| `/cmd_vel` | geometry_msgs/Twist | Publish | Manual velocity commands |
| `/global_costmap/costmap` | nav_msgs/OccupancyGrid | Subscribe | Global costmap data |
| `/fix` | sensor_msgs/NavSatFix | Subscribe | GPS position |
| `/odom` | nav_msgs/Odometry | Subscribe | Robot odometry |
| `/robot/stats` | std_msgs/String | Subscribe | JSON robot stats |

## Waypoint File Format

Waypoints are saved in YAML format at `/tmp/shared/waypoints.yaml`:

```yaml
waypoints:
  - lat: 37.7749
    lon: -122.4194
    alt: 0.0
    yaw_deg: 90.0
  - lat: 37.7750
    lon: -122.4195
    alt: 0.0
    yaw_deg: 180.0
```

This format is compatible with the existing `waypoint_server` ROS2 package.

## Environment Variables

### Backend
- `HOST` - Server host (default: 0.0.0.0)
- `PORT` - Server port (default: 8000)
- `ROSBRIDGE_URI` - ROSBridge WebSocket URI (default: ws://localhost:9090)
- `CORS_ORIGINS` - Comma-separated CORS origins
- `DEBUG` - Enable debug mode (true/false)

### Frontend
- `VITE_GOOGLE_MAPS_API_KEY` - Google Maps API key
- `VITE_API_URL` - Backend API URL (default: http://localhost:8000)
- `VITE_ROSBRIDGE_URL` - ROSBridge WebSocket URL (default: ws://localhost:9090)

## Troubleshooting

### Camera not working
1. Check camera device exists: `ls /dev/video*`
2. Verify permissions: `sudo usermod -aG video $USER`
3. Test camera: `ffplay /dev/video0`

### ROSBridge connection failed
1. Ensure ROSBridge is running: `ros2 launch rosbridge_server rosbridge_websocket_launch.xml`
2. Check port 9090 is accessible
3. Verify ROS_DOMAIN_ID matches

### Google Maps not loading
1. Verify API key in `.env` file
2. Enable Maps JavaScript API in Google Cloud Console
3. Check browser console for API errors

### Costmap not displaying
1. Ensure Navigation2 is running
2. Check `/global_costmap/costmap` topic: `ros2 topic echo /global_costmap/costmap`
3. Verify robot localization is working

## License

Part of the WALL-E Wildlife Monitoring Robot project.
