<!DOCTYPE html>
<html>
<head>
    <title>Robot Location and Video</title>
    <style>
        #joystick-zone {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            touch-action: none;
        }
    </style>
</head>
<body>
    <h1>Robot Current Location</h1>
    <p>Latitude: {{ gps.latitude }}</p>
    <p>Longitude: {{ gps.longitude }}</p>
    <p>Fix: {{ gps.fix }}</p>
    <p>Satellites: {{ gps.satellites }}</p>
    <p>Timestamp: {{ gps.timestamp }}</p>

    <h2>Map View</h2>
    <iframe
        width="600"
        height="450"
        style="border:0"
        loading="lazy"
        allowfullscreen
        src="https://maps.google.com/maps?q={{ gps.latitude }},{{ gps.longitude }}&z=15&output=embed">
    </iframe>

    <h2>Live Camera Feed</h2>
    <img src="{{ url_for('video_feed') }}" width="640" height="480" alt="Live Camera Feed">

    <h2>Generated Map</h2>
    <img src="{{ url_for('map_feed') }}" width="640" height="480" alt="Generated Map">

    <h2>Joystick Control</h2>
    <div id="joystick-zone"></div>

    <!-- Include libraries -->
    <!--script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.7.3/nipplejs.min.js"></script>
    <!--
    <script>
        // Replace this IP with your ROS machineâ€™s IP
        var ros = new ROSLIB.Ros({
            url: 'ws://192.168.1.100:9090'
        });

        ros.on('connection', function() {
            console.log('Connected to websocket server.');
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
        });

        var cmdVel = new ROSLIB.Topic({
            ros: ros,
            name: '/cmd_vel',
            messageType: 'geometry_msgs/Twist'
        });

        var joystick = nipplejs.create({
            zone: document.getElementById('joystick-zone'),
            mode: 'static',
            position: { left: '50%', top: '50%' },
            color: 'blue',
            size: 150
        });

        joystick.on('move', function(evt, data) {
            if (data.direction) {
                var linear = data.vector.y * -0.5;
                var angular = data.vector.x * -1.0;

                var twist = new ROSLIB.Message({
                    linear: { x: linear, y: 0.0, z: 0.0 },
                    angular: { x: 0.0, y: 0.0, z: angular }
                });

                cmdVel.publish(twist);
            }
        });

        joystick.on('end', function() {
            // Stop when joystick is released
            var stop = new ROSLIB.Message({
                linear: { x: 0.0, y: 0.0, z: 0.0 },
                angular: { x: 0.0, y: 0.0, z: 0.0 }
            });

            cmdVel.publish(stop);
        });
    </script>-->
</body>
</html>
